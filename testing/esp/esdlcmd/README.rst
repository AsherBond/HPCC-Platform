esdlcmd Regression Script
=========================

Runs esdl tool commands with known inputs to compare results to known correct key results. It currently supports testing the commands:

- manifest
- cpp
- java
- wsdl
- xsd

Usage
------

usage: esdlcmd-test.py [-h] [-o OUTDIR] [-e ESDLPATH] [-x XSLPATH] [-d] testroot

Test the functioning of the esdl command. Version 0.1

positional arguments:
  testroot              Path of the root folder of the esdlcmd testing project

optional arguments:
  -h, --help            show this help message and exit
  -o OUTDIR, --outdir OUTDIR
                        Directory name of output for tests. Defaults to creating 'esdlcmd-
                        test-output' in the current directory.
  -e ESDLPATH, --esdlpath ESDLPATH
                        Path to the esdl executable to test.
  -x XSLPATH, --xslpath XSLPATH
                        Path to the folder containing ESP's xslt/*.xslt transforms.
                        Defaults to /opt/HPCCSystems/componentfiles/
  -d, --debug           Enable debug logging of test cases


Test Contents
--------------

testing/esp/esdlcmd/esdlcmd-test.py
  Python3 script that runs the Test Cases and reports on failure or success. It creates a directory to hold the Test Case results. By default the output directory is named *esdlcmd-test-output* and is created in the current working directory. Its location can be specified with the ``-o`` command-line option. Run the script with the --help option to see all the usage details.

testing/esp/esdlcmd/inputs
  Contains esdl definitions used as inputs for the test cases. These inputs are used to exercise the esdl commands, for example to generate xsd, wsdl or c++ output.

testing/esp/esdlcmd/key
    Contains output generated by the esdl tool that is known to be correct. It is used as a *key* or baseline for comparison with the tool's output during a Test Case run.

Each entry in the key directory must match the name of Test Case it is for. For example, the Test Case named ``wsdl1`` to generate the wsdl for WsTest, has a file named ``wsdl1.wsdl`` in the key directory. Likewise, the Test Case named ``wstest-cpp-installdir`` that generates c++ files for the WsDfu service has a folder named ``wstest-cpp-installdir`` in the key directory.

Updating Test Cases
-------------------

If a change is made to the platform code that changes the output of the esdl tool, then the corresponding Test Cases that cover that esdl command must be updated. In practice this means:

1. Manually running the esdl command with the input from the test case.
2. Verifying by hand that the changed output is correct.
3. Updating the key in the testing/esp/esdlcmd/key directory with the new output. Note that the name of the updated key must match the name of the Test Case that generates that output. Some commands like ``wsdl`` generate a single file of output, and others like ``cpp`` generate a directory of output.
4. Commit the changes to the testing/esp/esdlcmd project.

Revision Notes
---------------
HPCC-24058 : Update wsdl key files to conform to default behavior- unspecified interface version defaults to version from ecm file. See HPCC-27571 "ESDL should default interface version". Print file diffs when test fails. Add cases for manifest command.
